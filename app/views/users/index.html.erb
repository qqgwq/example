<p id="notice"><%= notice %></p>
<div class="pull-right">
  <%= render 'export' %>
</div>

<div class="pull-right start">
  <%= form_tag users_path, method: :get, class: 'list' do %>
    <%= label_tag "start_at" %>
    <%= text_field_tag :start_at, nil, :class => 'datetimepicker', "data-date-format" => "yyyy-mm-dd" %>
    <%= label_tag "end_at" %>
    <%= text_field_tag :end_at, nil, :class => 'datetimepicker', "data-date-format" => "yyyy-mm-dd" %> 
    <%= submit_tag :Search, class: "btn btn-success", data: {disable_with: false}%>
  <% end %>
</div>

<div class="container">
  <div class="row">
    <div class="col-sm-9">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Email</th>
            <th>Content</th>
            <th>Create At</th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
        </thead>
      
        <tbody>
          <% @users.each do |user| %>
            <tr id="user_delete_<%= user.id %>" data-id="<%= user.id %>">
              <td><input type="checkbox" class="user_id" data-id = "<%= user.id %>"></td>
              <td><%= user.name %></td>
              <td><%= user.email %></td>
              <td><%= user.content %></td>
              <td><%= user.created_at.to_date %></td>
              <% if current_user %>
                <td><%= link_to 'Show', user_path(user) %></td>
              <% end %>
              <% if user == current_user %>
                <td><%= link_to 'Edit', edit_user_path(user) %></td>
                <td class="dog">Destroy</td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<br>

<% content_for :javascript do %>

<script type="text/javascript">

$(function() {
  var checkedIds = [];

  $('input:checkbox').change(
    function(e){
      if ($(this).is(':checked')) {
          checkedIds.push(e.target.dataset.id);
          $('#user_ids').val(checkedIds);
      } else {
          checkedIds.splice(e.target.dataset.id);
          $('#user_ids').val(checkedIds);
      };
    });
});

$(function(){
  $(document).on('turbolinks:before-cache', function () {
    /* ----------- Fix table header ----------- */
    $('table.table-bordered').floatThead('destroy')
  })

  $(document).on('turbolinks:load', function () {
    $(document).ready(function () {
      /* ----------- Fix table header ----------- */
      $('table.table-bordered').floatThead({
        position: 'absolute',
        autoReflow: true
      });
    });
  });
});

$(function(){
  $('.datetimepicker').datepicker()
});

</script>

<% end %>